<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>تحلیل هوشمند بازار</title>
    <style>
        body {
            font-family: Vazirmatn, sans-serif;
            background: #f2f2f2;
            padding: 30px;
        }
        .box {
            background: white;
            padding: 20px;
            border-radius: 12px;
            width: 420px;
            margin: auto;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        input, select, button {
            width: 100%;
            padding: 12px;
            font-size: 15px;
            margin-bottom: 15px;
            border-radius: 8px;
            border: 1px solid #ccc;
        }
        button {
            background: #2b7bff;
            color: white;
            border: none;
            cursor: pointer;
            font-size: 16px;
        }
        .result-box {
            background: #fafafa;
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            border: 1px solid #ddd;
        }
        .title {
            font-size: 18px;
            margin-bottom: 10px;
            font-weight: bold;
        }
        .error {
            color: red;
            margin-top: 10px;
            font-size: 14px;
        }
        .green { color: #0d8f45; }
        .red { color: #d12424; }
    </style>
</head>
<body>

<div class="box">
    <h2 style="text-align:center;">سیستم پیشرفته تحلیل بازار</h2>

    <label>نماد:</label>
    <input id="symbol" value="EUR/USD">

    <label>تایم‌فریم:</label>
    <select id="interval">
        <option value="1h">1H</option>
        <option value="30min">30M</option>
        <option value="15min">15M</option>
        <option value="1day">1D</option>
    </select>

    <button onclick="runAnalysis()">تحلیل کن</button>

    <div id="error" class="error"></div>

    <div id="result"></div>
</div>

<script>
function runAnalysis() {
    const sym = document.getElementById("symbol").value;
    const interval = document.getElementById("interval").value;
    const resultBox = document.getElementById("result");
    const errorBox = document.getElementById("error");

    resultBox.innerHTML = "";
    errorBox.innerHTML = "";

    fetch(`/analyze?symbol=${encodeURIComponent(sym)}&interval=${interval}`)
        .then(res => res.json())
        .then(data => {
            if (data.error) {
                errorBox.innerHTML = "❗ خطا: " + JSON.stringify(data);
                return;
            }

            let sigColor = data.signal === "buy" ? "green" : "red";

            resultBox.innerHTML = `
                <div class="result-box">
                    <div class="title">نتیجه تحلیل</div>

                    <p><strong>نماد:</strong> ${data.symbol}</p>
                    <p><strong>قیمت فعلی:</strong> ${data.price}</p>

                    <p><strong>سیگنال نهایی:</strong>
                        <span class="${sigColor}">
                            ${data.signal === "buy" ? "خرید" : "فروش"}
                        </span>
                    </p>

                    <p><strong>قدرت سیگنال:</strong> ${data.score}</p>
                    <p><strong>روند بازار:</strong> ${data.trend === "uptrend" ? "صعودی" : "نزولی"}</p>

                    <hr>

                    <div class="title">نقاط معامله</div>
                    <p><strong>نقطه ورود:</strong> ${data.price}</p>
                    <p><strong>حد ضرر (SL):</strong> ${data.setup.sl}</p>
                    <p><strong>حد سود (TP):</strong> ${data.setup.tp}</p>

                    <hr>

                    <div class="title">اندیکاتورها</div>
                    <p><strong>RSI:</strong> ${data.indicators.rsi}</p>
                    <p><strong>ATR:</strong> ${data.indicators.atr}</p>
                    <p><strong>EMA20:</strong> ${data.indicators.ema20}</p>
                    <p><strong>EMA50:</strong> ${data.indicators.ema50}</p>
                </div>
            `;
        });
}
</script>

</body>
</html>
